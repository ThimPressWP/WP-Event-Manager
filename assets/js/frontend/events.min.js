!function(e){var t={init:function(){var t=e(document);t.on("click",".event-load-booking-form",this.load_form_register),t.on("submit","form.event_register:not(.active)",this.book_event_form),this.sanitize_form_field(),t.on("submit","#event-lightbox .event-auth-form",this.ajax_login)},load_form_register:function(n){n.preventDefault();var i=e(this),o=i.attr("data-event");return e.ajax({url:WPEMS.ajaxurl,type:"POST",dataType:"html",async:!1,data:{event_id:o,nonce:WPEMS.register_button,action:"load_form_register"},beforeSend:function(){i.append('<i class="event-icon-spinner2 spinner"></i>')}}).always(function(){i.find(".event-icon-spinner2").remove()}).done(function(e){t.lightbox(e)}).fail(function(){}),!1},book_event_form:function(n){n.preventDefault();var i=e(this),o=i.serializeArray(),a=i.find('button[type="submit"]'),r=i.find(".tp-event-notice");return e.ajax({url:WPEMS.ajaxurl,type:"POST",data:o,dataType:"json",beforeSend:function(){r.slideUp().remove(),a.addClass("event-register-loading"),i.addClass("active")}}).done(function(n){return a.removeClass("event-register-loading"),"undefined"==typeof n.status?void t.set_message(i,WPEMS.something_wrong):(n.status===!0&&"undefined"!=typeof n.url&&""!==n.url&&(window.location.href=n.url),n.status===!0&&""==n.url&&"undefined"!=typeof n.event&&(e.magnificPopup.close(),e(".woocommerce-message").hide(),setTimeout(function(){e(".entry-register, .event_register_foot").append('<div class="woocommerce-message">'+WPEMS.woo_cart_url+"<p>“"+n.event+"”"+WPEMS.add_to_cart+"</p></div>")},100)),"undefined"!=typeof n.message?void t.set_message(i,n.message):void 0)}).fail(function(){a.removeClass("event-register-loading"),t.set_message(i,WPEMS.something_wrong)}).always(function(){i.removeClass("active")}),!1},set_message:function(e,t){var n='<div class="tp-event-notice error">';n+='<div class="event_auth_register_message_error">'+t+"</div>",n+="</div>",e.find(".event_register_foot").append(n)},sanitize_form_field:function(){for(var t=e(".form-row.form-required"),n=0;n<t.length;n++){var i=e(t[n]),o=i.find("input");o.on("blur",function(t){t.preventDefault();var n=e(this),i=n.parents(".form-row:first");i.hasClass("form-required")&&(""==n.val()?i.removeClass("validated").addClass("has-error"):i.removeClass("has-error").addClass("validated"))})}},lightbox:function(n){var i=[];i.push('<div id="event-lightbox">'),i.push(n),i.push("</div>"),e.magnificPopup.open({items:{type:"inline",src:e(i.join(""))},mainClass:"event-lightbox-wrap",callbacks:{open:function(){var n=e("#event-lightbox");n.addClass("event-fade");var i=setTimeout(function(){n.addClass("event-in"),clearTimeout(i),t.sanitize_form_field()},100)},close:function(){var t=e("#event-lightbox");t.remove()}}})},ajax_login:function(t){t.preventDefault();var n=e(this),i=n.find("#wp-submit"),o=e("#event-lightbox"),a=n.serializeArray();return e.ajax({url:WPEMS.ajaxurl,type:"POST",data:a,async:!1,beforeSend:function(){o.find(".tp-event-notice").slideUp().remove(),i.addClass("event-register-loading")}}).always(function(){i.find(".event-icon-spinner2").remove()}).done(function(e){"undefined"!=typeof e.notices&&n.before(e.notices),"undefined"!=typeof e.status&&e.status===!0&&("undefined"!=typeof e.redirect&&e.redirect?window.location.href=e.redirect:window.location.reload())}).fail(function(e,t,i){var o='<ul class="tp-event-notice error">';o+="<li>"+e+"</li>",o+="</ul>",n.before(res.notices)}),!1}};e(document).ready(function(){t.init();for(var n=e(".tp_event_counter"),i=0;i<n.length;i++){var o=e(n[i]).attr("data-time");o=new Date(o);var a=new Date(o-60*WPEMS.gmt_offset*60*1e3);e(n[i]).countdown({labels:WPEMS.l18n.labels,labels1:WPEMS.l18n.labels1,until:a,serverSync:WPEMS.current_time})}for(var r=e(".tp_event_owl_carousel"),i=0;i<r.length;i++){var s=e(r[i]).attr("data-countdown"),d={navigation:!0,slideSpeed:300,paginationSpeed:400,singleItem:!0};"undefined"!=typeof s&&(s=JSON.parse(s),e.extend(d,s),e.each(d,function(e,t){"true"===t?d[e]=!0:"false"===t&&(d[e]=!1)})),"undefined"==typeof d.slide||d.slide===!0?e(r[i]).owlCarousel(d):e(r[i]).removeClass("owl-carousel")}})}(jQuery);